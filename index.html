<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Cosmic Lipstick - Toxic Kawaii</title>
<style>
    /* åŸºæœ¬è¨­å®š */
    body { margin: 0; overflow: hidden; background-color: #050505; cursor: auto; font-family: 'Hiragino Sans', 'Meiryo', sans-serif; touch-action: none; }
    canvas { display: block; }
    
    /* ã€NEWã€‘å¯æ„›ãã¦è¦‹ã‚„ã™ã„ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ */
    #gameOver {
        display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        /* èƒŒæ™¯ã‚’ãƒ”ãƒ³ã‚¯ç´«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã« */
        background: linear-gradient(135deg, rgba(50,0,50,0.95), rgba(20,0,20,0.98));
        color: #FFFFFF; text-align: center; padding: 40px; 
        /* ãƒã‚ªãƒ³ãƒ”ãƒ³ã‚¯ã®å¯æ„›ã„æ ç·š */
        border: 4px solid #FF69B4; border-radius: 25px;
        box-shadow: 0 0 30px rgba(255, 105, 180, 0.6);
        z-index: 100; width: 85%; box-sizing: border-box;
    }
    #gameOver h1 { 
        font-size: 32px; margin-bottom: 15px; letter-spacing: 2px; color: #FF69B4;
        text-shadow: 0 0 10px #FF69B4; /* ã‚­ãƒ©ã‚­ãƒ©æ–‡å­— */
    }
    #gameOver p { 
        font-size: 20px; margin-bottom: 30px; color: #FFFFFF; font-weight: bold; line-height: 1.5;
    }
    /* å¯æ„›ã„ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ */
    button { 
        padding: 12px 40px; font-size: 18px; 
        background: #FF69B4; color: white; border: none; border-radius: 50px;
        cursor: pointer; font-weight: bold; box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
        transition: transform 0.1s;
    }
    button:active { transform: scale(0.95); }

    /* ãƒ•ã‚£ãƒ¼ãƒãƒ¼è¡¨ç¤º */
    #feverMode {
        display: none; position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
        color: #FF00FF; font-size: 32px; font-weight: bold; text-shadow: 0 0 20px #FF00FF;
        animation: blink 0.1s infinite; z-index: 50; white-space: nowrap;
    }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
</style>
</head>
<body id="mainBody">

<div id="feverMode">âš ï¸ MIRACLE FEVER (LUCKY YOU) âš ï¸</div>
<div id="gameOver">
    <h1>ğŸ€ GAME OVER ğŸ€</h1>
    <p id="deathMessage">ä¸€ç”Ÿã‚«ã‚µã‚«ã‚µã—ã¦ãªï½—</p>
    <button onclick="location.reload()">RETRY âœ¨</button>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const feverUI = document.getElementById('feverMode');

let isPortrait = false; 
let gameScale = 1;
const VIRTUAL_WIDTH = 800; 

const enemyImg = new Image();
enemyImg.src = 'unnamed__1_-removebg-preview.png'; 
const playerImg = new Image();
playerImg.src = 'player.png'; 

let player = { x: 0, y: 0, width: 90, height: 45 };
let targetPos = { x: 0, y: 0 };
let bullets = [];
let stars = [];
let enemies = [];
let score = 0;
let isGameOver = false;
let isFever = false;
let feverTimer = 0;
let lastFeverScore = 0;

// è¾›è¾£ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãã®ã¾ã¾ç¶­æŒ
const toxicMessages = [
    "ã‚«ã‚µã‚«ã‚µã ã‚ˆã‰ğŸ¥º",
    "ã‚»ãƒ³ã‚¹ã©ã“ãƒ¼ï¼Ÿâœ¨",
    "ã¾ã ã¾ã ã ã­ã£â¤ï¸",
    "ã¸ãŸã£ã´ã•ã‚“ğŸ€",
    "ã‚„ã‚ŠãªãŠã—ã£ï¼âœ¨",
    "æ½¤ã„ã‚¼ãƒ­ã ã‚ˆã‰ğŸ¥º",
    "ã‚‚ã£ã¨é ‘å¼µã£ã¦ï¼Ÿâ¤ï¸",
    "ã©ã‚“ã¾ã„ã©ã‚“ã¾ã„âœ¨",
    "ã‚«ã‚µã‚«ã‚µã™ãã‚‹ã…ğŸ¥º",
    "å¯æ„›ããªã„ã‚ˆã‰â¤ï¸",
    "ã‚»ãƒ³ã‚¹è¿·å­ã‹ãªï¼Ÿâœ¨",
    "ã‚‚ã£ã¨ã‚­ãƒ©ã‚­ãƒ©ã—ã‚ˆğŸ€",
    "å…¨ç„¶ãƒ€ãƒ¡ãƒ€ãƒ¡ã€œğŸ¥º",
    "ã‚„ã‚Šç›´ã—ã£ï¼â¤ï¸",
    "ãŠè‚Œãƒœãƒ­ãƒœãƒ­ã ã‚ˆâœ¨",
    "ã‚»ãƒ³ã‚¹ãªã„ã­ã£ğŸ€",
    "ã¸ãŸããã‰â¤ï¸",
    "ã‚‚ã£ã‹ã„ã‚„ã‚‹ï¼ŸğŸ¥º",
    "å¥³å­åŠ›ã‚¼ãƒ­ã£âœ¨",
    "å‡ºç›´ã—ã¦ãã¦ğŸ€",
    "ã‚»ãƒ³ã‚¹ãŒæ­»ã‚“ã§ã‚‹ğŸ¥º",
    "ã‚­ãƒ©ã‚­ãƒ©è¶³ã‚Šãªã„â¤ï¸",
    "ä¸‹æ‰‹ã™ãã¦ã‚¦ã‚±ã‚‹âœ¨",
    "ã‚„ã‚Šç›´ã—ãªã•ã„ã£ğŸ€",
    "ã‚»ãƒ³ã‚¹ãªã•ã™ãã£ğŸ¥º",
    "æ¬¡ã“ãé ‘å¼µã£ã¦ï¼Ÿâ¤ï¸"
];

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    isPortrait = canvas.height > canvas.width; 
    if (isPortrait) {
        gameScale = canvas.width / 450; player.x = 225; player.y = (canvas.height / gameScale) - 100;
    } else {
        gameScale = canvas.width / VIRTUAL_WIDTH; player.x = 100; player.y = (canvas.height / gameScale) / 2;
    }
    targetPos.x = player.x; targetPos.y = player.y;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

for (let i = 0; i < 80; i++) {
    stars.push({ x: Math.random() * 1000, y: Math.random() * 1500, size: Math.random() * 1.5, opacity: Math.random() });
}

const updateTarget = (x, y) => {
    if (isPortrait) { targetPos.x = x / gameScale; } else { targetPos.y = y / gameScale; }
};

window.addEventListener('mousemove', (e) => { if(!isGameOver) updateTarget(e.clientX, e.clientY); });
window.addEventListener('mousedown', (e) => { if(!isGameOver && !isFever) fireGlitter(); });
canvas.addEventListener('touchstart', (e) => {
    if(!isGameOver) {
        updateTarget(e.touches[0].clientX, e.touches[0].clientY);
        if (!isFever) fireGlitter();
    }
    e.preventDefault();
}, { passive: false });
canvas.addEventListener('touchmove', (e) => {
    if(!isGameOver) updateTarget(e.touches[0].clientX, e.touches[0].clientY);
    e.preventDefault();
}, { passive: false });

function fireGlitter() {
    bullets.push({ x: player.x, y: player.y, vx: isPortrait ? 0 : 22, vy: isPortrait ? -22 : 0, size: 25, life: 40 });
}

function spawnEnemy() {
    let spawnRate = 0.04 + (score / 10000);
    if (Math.random() < spawnRate) {
        let ex, ey;
        if (isPortrait) { ex = Math.random() * (canvas.width / gameScale); ey = -100; }
        else { ex = VIRTUAL_WIDTH + 100; ey = Math.random() * (canvas.height / gameScale); }
        let baseSpeed = 4 + (score / 200);
        // ã€NEWã€‘ãƒã‚±ãƒ¢ãƒã®ã‚µã‚¤ã‚ºã‚’å°‘ã—å°ã•ã(115 -> 90)
        enemies.push({ x: ex, y: ey, width: 90, height: 90, speed: baseSpeed + Math.random() * 3, status: 'normal', timer: 0, wiggle: Math.random() * Math.PI });
    }
}

function drawFish(e) {
    ctx.save();
    ctx.translate(e.x, e.y);
    const wiggle = Math.sin(Date.now() * 0.01 + e.wiggle) * 20;
    if (isPortrait) ctx.translate(wiggle, 0); else ctx.translate(0, wiggle);
    if (e.status === 'normal') {
        if (enemyImg.complete) ctx.drawImage(enemyImg, -e.width/2, -e.height/2, e.width, e.height);
    } else {
        ctx.fillStyle = "#FF69B4"; // æµ„åŒ–æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚‚å°‘ã—å°ã•ã
        ctx.beginPath(); ctx.ellipse(0, 0, 35, 25, 0, 0, Math.PI * 2); ctx.fill();
    }
    ctx.restore();
}

function updateEnemies() {
    for (let i = enemies.length - 1; i >= 0; i--) {
        let e = enemies[i];
        if (e.status === 'normal') {
            if (isPortrait) e.y += e.speed; else e.x -= e.speed;
            bullets.forEach((b) => {
                // å½“ãŸã‚Šåˆ¤å®šã‚‚ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦å°‘ã—å°ã•ã
                if (Math.hypot(b.x - e.x, b.y - e.y) < 55) { e.status = 'purified'; score += 10; }
            });
            
            const isCollided = Math.hypot(player.x - e.x, player.y - e.y) < 50;
            const isPassedPC = !isPortrait && e.x < player.x - 50;
            const isPassedMobile = isPortrait && e.y > player.y + 50;

            if (isCollided || isPassedPC || isPassedMobile) {
                isGameOver = true; 
                document.getElementById('deathMessage').innerHTML = toxicMessages[Math.floor(Math.random() * toxicMessages.length)];
                document.getElementById('gameOver').style.display = 'block';
            }
        } else { e.y -= 25; e.x += 25; }
        drawFish(e);
        if (e.x < -600 || e.y > 2500 || e.y < -700) enemies.splice(i, 1);
    }
}

function updateBullets() {
    for (let i = bullets.length - 1; i >= 0; i--) {
        let b = bullets[i];
        b.x += b.vx; b.y += b.vy; b.life--;
        ctx.save();
        ctx.shadowBlur = 8; ctx.shadowColor = '#FFB6C1';
        for(let j=0; j<15; j++) {
            ctx.fillStyle = j % 2 === 0 ? '#FF69B4' : '#FFFFFF';
            ctx.beginPath(); 
            ctx.arc(b.x + (Math.random()-0.5)*30, b.y + (Math.random()-0.5)*30, Math.random()*1.5, 0, Math.PI*2); 
            ctx.fill();
        }
        ctx.restore();
        if (b.life <= 0) bullets.splice(i, 1);
    }
}

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y);
    if (isPortrait) ctx.rotate(-Math.PI / 2);
    if (playerImg.complete) {
        ctx.shadowBlur = 30; ctx.shadowColor = '#FF69B4';
        ctx.drawImage(playerImg, -player.width/2, -player.height/2, player.width, player.height);
    }
    ctx.restore();
}

function gameLoop() {
    if (isGameOver) return;
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.fillStyle = "#050505"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.setTransform(gameScale, 0, 0, gameScale, 0, 0);

    if (score > 0 && score % 500 === 0 && score !== lastFeverScore) {
        isFever = true; feverTimer = 180; lastFeverScore = score; feverUI.style.display = 'block';
    }
    if (isFever) {
        feverTimer--; if (feverTimer % 4 === 0) fireGlitter();
        if (feverTimer <= 0) { isFever = false; feverUI.style.display = 'none'; }
    }

    ctx.fillStyle = "white";
    stars.forEach(s => { ctx.globalAlpha = 0.3; ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill(); });
    ctx.globalAlpha = 1.0;

    spawnEnemy();
    updateEnemies();
    player.x += (targetPos.x - player.x) * 0.25;
    player.y += (targetPos.y - player.y) * 0.25;
    updateBullets();
    drawPlayer();
    
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.fillStyle = "#FF00FF"; ctx.font = "bold 20px Arial";
    ctx.fillText(`SCORE: ${score}`, 20, 35);
    requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
