<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Cosmic Lipstick - Final Cute Ver.</title>
<style>
    /* ã‚¹ãƒãƒ›ã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„ã‚ºãƒ¼ãƒ ã‚’é˜²æ­¢ */
    body { margin: 0; overflow: hidden; background-color: #050505; cursor: none; font-family: 'Arial', sans-serif; touch-action: none; }
    canvas { display: block; }
    #gameOver {
        display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        color: #FF00FF; text-align: center; background: rgba(0,0,0,0.9); padding: 40px; 
        border: 10px double #FF00FF; z-index: 100; width: 80%; box-sizing: border-box;
    }
    #feverMode {
        display: none; position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
        color: #FF00FF; font-size: 30px; font-weight: bold; text-shadow: 0 0 20px #FF00FF;
        animation: blink 0.2s infinite; z-index: 50; white-space: nowrap;
    }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    button { padding: 10px 20px; font-size: 20px; background: #FF00FF; color: white; border: none; cursor: pointer; font-weight: bold; }
    .show-cursor { cursor: auto !important; }
</style>
</head>
<body id="mainBody">
<div id="feverMode">âœ¨ GLITTER FEVER âœ¨</div>
<div id="gameOver">
    <h1>ğŸ’€ DRY & DEAD ğŸ’€</h1>
    <p>æ½¤ã„ãŒè¶³ã‚Šãªã„ã‚...</p>
    <button onclick="location.reload()">RETRY</button>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const body = document.getElementById('mainBody');
const feverUI = document.getElementById('feverMode');

// ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«åˆã‚ã›ã‚‹é–¢æ•°
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// --- ç”»åƒã®èª­ã¿è¾¼ã¿ ---
// æ•µã®ç”»åƒ (GitHubã®ãƒ•ã‚¡ã‚¤ãƒ«åã¨å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹ï¼)
const enemyImg = new Image();
enemyImg.src = 'unnamed__1_-removebg-preview.png'; 

// ã€NEWã€‘ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(ãƒªãƒƒãƒ—)ã®ç”»åƒ
// â€» GitHubã« 'player.png' ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼
const playerImg = new Image();
playerImg.src = 'player.png'; 

let player = { x: 80, y: canvas.height / 2, width: 100, height: 50 }; // ç”»åƒã«åˆã‚ã›ã¦å°‘ã—å¤§ãã
let targetY = canvas.height / 2;
let bullets = [];
let paintTrails = [];
let stars = [];
let enemies = [];
let score = 0;
let isGameOver = false;
let isFever = false;
let feverTimer = 0;
let lastFeverScore = 0;

// æ˜Ÿã®ç”Ÿæˆ
for (let i = 0; i < 150; i++) {
    stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 1.5, opacity: Math.random(), twinkleSpeed: 0.02 + Math.random() * 0.05 });
}

// --- æ“ä½œã‚¤ãƒ™ãƒ³ãƒˆ (PC & ã‚¹ãƒãƒ›å¯¾å¿œ) ---
window.addEventListener('mousemove', (e) => { if(!isGameOver) targetY = e.clientY; });
window.addEventListener('mousedown', (e) => {
    if(!isGameOver && !isFever && e.target === canvas) fireGlitter();
});

// ã‚¹ãƒãƒ›ç”¨ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
canvas.addEventListener('touchstart', (e) => {
    if(!isGameOver) {
        targetY = e.touches[0].clientY;
        if (!isFever) fireGlitter();
    }
    e.preventDefault();
}, { passive: false });

canvas.addEventListener('touchmove', (e) => {
    if(!isGameOver) targetY = e.touches[0].clientY;
    e.preventDefault();
}, { passive: false });


function fireGlitter() {
    bullets.push({ x: player.x + 40, y: player.y, speed: 18, size: 25, life: 60 });
}

function spawnEnemy() {
    if (Math.random() < 0.03) {
        // ã‚¹ãƒãƒ›ã ã¨ç”»é¢ãŒç‹­ã„ã®ã§æ•µã‚’å°‘ã—å°ã•ã‚ã«èª¿æ•´
        const size = window.innerWidth < 600 ? 80 : 120;
        enemies.push({
            x: canvas.width + 100, y: Math.random() * canvas.height,
            width: size, height: size, speed: 2.5 + Math.random() * 4,
            status: 'normal', timer: 0, wiggle: Math.random() * Math.PI 
        });
    }
}

function drawStars() {
    ctx.fillStyle = "white";
    stars.forEach(s => {
        s.opacity += s.twinkleSpeed;
        if (s.opacity > 1 || s.opacity < 0) s.twinkleSpeed *= -1;
        ctx.globalAlpha = Math.abs(s.opacity);
        ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2); ctx.fill();
    });
    ctx.globalAlpha = 1.0;
}

function drawPaintedArea(time) {
    ctx.save();
    ctx.beginPath();
    paintTrails.forEach(p => { ctx.moveTo(p.x, p.y); ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2); });
    ctx.clip();
    const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width);
    const hue = isFever ? 320 : 300;
    gradient.addColorStop(0, `hsl(${hue}, 100%, ${Math.sin(time * 0.05) * 20 + 60}%)`);
    gradient.addColorStop(1, '#110011');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.restore();
}

function drawFish(e) {
    ctx.save();
    ctx.translate(e.x, e.y);
    const wiggleY = Math.sin(Date.now() * 0.008 + e.wiggle) * 15;
    ctx.translate(0, wiggleY);
    if (e.status === 'normal') {
        if (enemyImg.complete) ctx.drawImage(enemyImg, -e.width/2, -e.height/2, e.width, e.height);
    } else {
        // æµ„åŒ–å¾Œã®ã‚®ãƒ£ãƒ«é­šã‚‚å°‘ã—å°ã•ã‚ã«èª¿æ•´
        const scale = e.width / 120;
        ctx.shadowBlur = 40; ctx.shadowColor = "#FF00FF";
        ctx.fillStyle = "#FF69B4";
        ctx.beginPath(); ctx.ellipse(0, 0, 70*scale, 50*scale, 0, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = "#FF00FF";
        ctx.beginPath(); ctx.moveTo(0, -35*scale); ctx.lineTo(35*scale, -70*scale); ctx.lineTo(35*scale, 5*scale); ctx.fill();
        ctx.beginPath(); ctx.moveTo(0, -35*scale); ctx.lineTo(-35*scale, -70*scale); ctx.lineTo(-35*scale, 5*scale); ctx.fill();
        ctx.fillStyle = "#FF1493"; 
        ctx.beginPath(); ctx.ellipse(-50*scale, 20*scale, 30*scale, 15*scale, 0, 0, Math.PI * 2); ctx.fill();
    }
    ctx.restore();
}

function updateEnemies() {
    for (let i = enemies.length - 1; i >= 0; i--) {
        let e = enemies[i];
        if (e.status === 'normal') {
            e.x -= e.speed;
            bullets.forEach((b) => {
                if (Math.hypot(b.x - e.x, b.y - e.y) < e.width/1.8) {
                    e.status = 'purified';
                    score += 10;
                    paintTrails.push({ x: e.x, y: e.y, radius: 250 });
                }
            });
            if (Math.hypot(player.x - e.x, player.y - e.y) < e.width/2) {
                isGameOver = true;
                body.classList.add('show-cursor');
                document.getElementById('gameOver').style.display = 'block';
            }
        } else {
            e.x += 20; e.y -= 20; e.timer++;
            if(e.timer % 2 === 0) paintTrails.push({ x: e.x, y: e.y, radius: 50 });
        }
        drawFish(e);
        if (e.x < -300 || e.y < -300 || e.x > canvas.width + 500) enemies.splice(i, 1);
    }
}

function updateBullets() {
    for (let i = bullets.length - 1; i >= 0; i--) {
        let b = bullets[i];
        b.x += b.speed; b.life--;
        ctx.save();
        ctx.shadowBlur = 15; ctx.shadowColor = '#FFB6C1';
        for(let j=0; j<5; j++) {
            ctx.fillStyle = j % 2 === 0 ? '#FF69B4' : '#FFFFFF';
            ctx.beginPath();
            ctx.arc(b.x + (Math.random()-0.5)*30, b.y + (Math.random()-0.5)*30, Math.random()*4, 0, Math.PI*2);
            ctx.fill();
        }
        ctx.restore();
        paintTrails.push({ x: b.x, y: b.y, radius: b.size });
        if (b.life <= 0 || b.x > canvas.width + 50) bullets.splice(i, 1);
    }
}

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y);
    
    // ã€NEWã€‘ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãŸã‚‰ç”»åƒã‚’è¡¨ç¤ºï¼
    if (playerImg.complete) {
        ctx.shadowBlur = 30; ctx.shadowColor = '#FF69B4';
        // ç”»åƒã‚’ä¸­å¿ƒã«æç”»
        ctx.drawImage(playerImg, -player.width/2, -player.height/2, player.width, player.height);
    } else {
        // ç”»åƒãŒãªã„æ™‚ã®ä»®ã®å§¿ï¼ˆãƒ”ãƒ³ã‚¯ã®å››è§’ï¼‰
        ctx.fillStyle = '#FF69B4';
        ctx.fillRect(-40, -20, 80, 40);
    }
    ctx.restore();
}

function gameLoop() {
    if (isGameOver) return;
    ctx.fillStyle = "#050505";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    if (score > 0 && score % 100 === 0 && score !== lastFeverScore) {
        isFever = true;
        feverTimer = 300;
        lastFeverScore = score;
        feverUI.style.display = 'block';
    }

    if (isFever) {
        feverTimer--;
        if (feverTimer % 5 === 0) fireGlitter();
        if (feverTimer <= 0) {
            isFever = false;
            feverUI.style.display = 'none';
        }
    }

    drawStars();
    drawPaintedArea(Date.now() / 20);
    spawnEnemy();
    updateEnemies();
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®ã®æ»‘ã‚‰ã‹ãªæ›´æ–°
    player.y += (targetY - player.y) * 0.2;
    updateBullets();
    drawPlayer();
    
    ctx.fillStyle = "#FF00FF"; ctx.font = "bold 28px Arial";
    ctx.fillText(`PURIFIED: ${score}`, 20, 50);
    requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
