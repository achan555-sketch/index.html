<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmic Lipstick Prototype v0.2</title>
<style>
    body { margin: 0; overflow: hidden; background-color: #110011; cursor: none; }
    canvas { display: block; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- プレイヤー設定 ---
let player = {
    x: 100, y: canvas.height / 2, width: 60, height: 30, // サイズを横長に
    colorBody: '#FF69B4', // 本体（ホットピンク）
    colorTip: '#FF1493'   // 先端（濃いピンク）
};
let mouseY = canvas.height / 2;

// --- 弾の設定 ---
let bullets = []; // 発射された弾を入れる配列

// --- イベントリスナー ---
window.addEventListener('mousemove', (e) => { mouseY = e.clientY; });
window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
// クリックで弾を発射！
window.addEventListener('mousedown', (e) => {
    bullets.push({
        x: player.x + player.width / 2, // 口紅の先端から発射
        y: player.y,
        speed: 15,
        size: 20 + Math.random() * 10 // サイズを少しランダムに
    });
});

// --- 描画関数たち ---

// 口紅ロケットを描く関数
function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y); // プレイヤーの中心を基準にする

    // 発光エフェクト
    ctx.shadowBlur = 20; ctx.shadowColor = player.colorBody;

    // 1. 本体（筒の部分）
    ctx.fillStyle = player.colorBody;
    // 角丸の四角形を描く（それっぽく見せるため）
    ctx.beginPath();
    ctx.roundRect(-player.width/2, -player.height/2, player.width*0.7, player.height, [5, 0, 0, 5]);
    ctx.fill();

    // 2. 先端（口紅の部分）
    ctx.fillStyle = player.colorTip;
    ctx.beginPath();
    // 斜めにカットされたような形を描く
    ctx.moveTo(player.width*0.2, -player.height/2 + 5);
    ctx.lineTo(player.width/2, -player.height/4);
    ctx.lineTo(player.width/2, player.height/4);
    ctx.lineTo(player.width*0.2, player.height/2 - 5);
    ctx.closePath();
    ctx.fill();
    
    // 3. エンジンの噴射（おまけ）
    ctx.shadowBlur = 30; ctx.shadowColor = '#00FFFF'; // 青白い光
    ctx.fillStyle = '#FFFFFF';
    ctx.beginPath();
    ctx.arc(-player.width/2, 0, 8 + Math.random()*4, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
}

// 弾（色の波）を描く関数
function drawBullets() {
    for (let i = bullets.length - 1; i >= 0; i--) {
        let b = bullets[i];
        b.x += b.speed; // 弾を右に進める

        ctx.save();
        // 弾の発光エフェクト
        ctx.shadowBlur = b.size; ctx.shadowColor = '#FF00FF';
        ctx.fillStyle = 'rgba(255, 105, 180, 0.8)'; // 少し透明なピンク
        
        // ただの丸ではなく、「波」っぽく横長に描く
        ctx.beginPath();
        ctx.ellipse(b.x, b.y, b.size, b.size/2, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();

        // 画面外に出た弾を消す（メモリ節約）
        if (b.x > canvas.width + b.size) {
            bullets.splice(i, 1);
        }
    }
}


// --- ゲームループ ---
let time = 0;
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. 背景（前回のまま）
    time += 0.05;
    const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width);
    const intensity = Math.sin(time) * 20 + 30;
    gradient.addColorStop(0, `hsl(300, 100%, ${intensity}%)`);
    gradient.addColorStop(1, '#110011');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 2. プレイヤーの位置更新
    player.y += (mouseY - player.y) * 0.1;

    // 3. 弾の更新と描画
    drawBullets();

    // 4. プレイヤーの描画
    drawPlayer();

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
