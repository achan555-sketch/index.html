<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmic Lipstick Phase 2</title>
<style>
    body { margin: 0; overflow: hidden; background-color: #050505; cursor: none; }
    canvas { display: block; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ & å¼¾ ---
let player = { x: 100, y: canvas.height / 2, width: 60, height: 30, colorBody: '#FF69B4', colorTip: '#FF1493' };
let mouseY = canvas.height / 2;
let bullets = [];

// --- ğŸŒŸ æ˜Ÿç©ºã®è¨­å®š (Phase 2 è¿½åŠ ) ---
let stars = [];
const starCount = 150;
for (let i = 0; i < starCount; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: Math.random() * 1.5,
        opacity: Math.random(),
        twinkleSpeed: 0.02 + Math.random() * 0.05 // å…‰ã‚‹é€Ÿã•
    });
}

// --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
window.addEventListener('mousemove', (e) => { mouseY = e.clientY; });
window.addEventListener('mousedown', () => {
    bullets.push({ x: player.x + player.width/2, y: player.y, speed: 18, size: 25 });
});

// --- æç”»é–¢æ•° ---

// æ˜Ÿã‚’æã (ãƒ¢ãƒã‚¯ãƒ­ãƒ»ã‚­ãƒ©ã‚­ãƒ©)
function drawStars() {
    ctx.fillStyle = "white";
    stars.forEach(s => {
        // æ˜Ÿã‚’ãƒã‚«ãƒã‚«ã•ã›ã‚‹è¨ˆç®—
        s.opacity += s.twinkleSpeed;
        if (s.opacity > 1 || s.opacity < 0) s.twinkleSpeed *= -1;
        
        ctx.globalAlpha = Math.abs(s.opacity); // é€æ˜åº¦ã‚’å¤‰ãˆã‚‹
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
        ctx.fill();
    });
    ctx.globalAlpha = 1.0; // é€æ˜åº¦ã‚’æˆ»ã™
}

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.shadowBlur = 20; ctx.shadowColor = player.colorBody;
    ctx.fillStyle = player.colorBody;
    ctx.beginPath();
    ctx.roundRect(-player.width/2, -player.height/2, player.width*0.7, player.height, [5, 0, 0, 5]);
    ctx.fill();
    ctx.fillStyle = player.colorTip;
    ctx.beginPath();
    ctx.moveTo(player.width*0.2, -player.height/2 + 5);
    ctx.lineTo(player.width/2, -player.height/4);
    ctx.lineTo(player.width/2, player.height/4);
    ctx.lineTo(player.width*0.2, player.height/2 - 5);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
}

function drawBullets() {
    bullets.forEach((b, i) => {
        b.x += b.speed;
        ctx.save();
        ctx.shadowBlur = 15; ctx.shadowColor = '#FF00FF';
        ctx.fillStyle = 'rgba(255, 20, 147, 0.9)';
        ctx.beginPath();
        ctx.ellipse(b.x, b.y, b.size, b.size/3, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    });
    bullets = bullets.filter(b => b.x < canvas.width + 50); // ç”»é¢å¤–ã®å¼¾ã‚’å‰Šé™¤
}

// --- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— ---
function gameLoop() {
    // èƒŒæ™¯ã‚’çœŸã£é»’ã«å¡—ã‚‹
    ctx.fillStyle = "#050505";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    drawStars();   // 1. ã‚­ãƒ©ã‚­ãƒ©ã®æ˜Ÿã‚’æã
    player.y += (mouseY - player.y) * 0.1;
    drawBullets(); // 2. å¼¾ã‚’æã
    drawPlayer();  // 3. è‡ªæ©Ÿã‚’æã

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
